<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="author" content="de Diego, Elena">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles.css">
    <title>Práctica 6: Conexiones TCP</title>
</head>
<body>
<div class="pagina">
<header>
    <h6>
        <span id="asignatura"></span>
        <span>Conexiones TCP</span>
    </h6>
</header>
<h1>Práctica 6: Conexiones TCP</h1>
<div id="console"></div>
<div id="toc">
	<h3>Índice</h3>
	<noscript>Para poder visualizar el índice y que la página tenga plena funcionalidad, por favor, habilite el uso de JavaScript en su navegador.</noscript>
</div>
<hr/>
<div id="contents">
<h2>Introducción</h2>
<p>La quinta práctica de planificación y administración de redes trata sobre la <b>capa de transporte</b>, es decir, la cuarta del modelo ISO/OSI empezando por el nivel físico. Este nivel es el primero que <b>une procesos</b> en vez de <i>hosts</i>, tal y como hacía el anterior, el de red. Suele ser la primera capa visible por los programadores, por lo que el nivel IP puede considerarse como la <i>frontera</i> entre estos y nosotros, los <i>administradores</i>.</p>
<p>La capa de transporte se compone de los protocolos <b>UDP</b> (<i>User Datagram Protocol</i>) y <b>TCP</b> (<i>Transmission Control Protocol</i>). El primero <b>no está orientado a conexión y no es fiable</b>, mientras que el segundo, TCP, <b>sí posee estas dos cualidades</b>.</p>
<p>El comando que emplearemos para poder escuchar en los puertos y conectarnos con otros ordenadores es <span class="codigo">nc</span> (o más conocido como <span class="codigo">netcat</span>), el cual puede manejar ambos protocolos según se especifica en su <a href="https://www.unix.com/man-page/linux/1/nc/">manual</a>, pero el uso que se le dará mayoritariamente en este trabajo estará enfocado a TCP.</p>
<p>En el protocolo TCP, se establecen conexiones de la siguiente manera: Primero, <b>un servidor está escuchando en un puerto</b> y, posteriormente, <b>un cliente le envía una solicitud de conexión</b>. El servidor responde con una <b>aceptación de la conexión</b> y, después, el cliente <b><i>acepta</i> la aceptación</b>, por lo que consigue conectarse. Hay diferentes estados:</p>
<ul>
    <li><u>Cerrado</u>: Ninguna conexión.</li>
    <li><u>Escuchando</u>: Un servidor está esperando en un puerto a ser conectado.</li>
    <li><u>Establecido</u>: Un cliente ha conectado con un servidor.</li>
    <li><u>Espera</u>: Aguardando a que la conexión termine.</li>
</ul>
<p>Los puertos, tanto de TCP como de UDP, son un total de 65536 (<b>2<sup>16</sup></b>) y son asignados por la RFC 1700 de la siguiente manera:</p>
<ul>
    <li><u>Puertos bien conocidos</u>, que van del 0 al 1023 y son solo para el administrador.</li>
    <li><u>Puertos registrados</u>, del 1024 al 49151, y son para servicios menos críticos.</li>
    <li><u>Puertos dinámicos</u>, del 49152 al 65535, y son asignables a los clientes.</li>
</ul>
<p>En Linux, la lista de puertos conocidos está en el fichero <span class="codigo">/etc/services</span>.</p>
<p>El objetivo de esta práctica no es otro que –como en muchas otras prácticas– familia­rizarse con los conceptos de esta unidad, como el de <i>puerto</i> o <i>conexión</i>. También, se trata de poder ser capaces de crear servicios simples de red, así como de utilizarlos y de monitorizar el estado de las conexiones de red.</p>
<p>Los ejercicios de esta práctica pueden consultarse en <a href="par-6-practicas-nc.pdf" target="_blank">este enlace</a>.</p>
<h2>Crear un chat con otros ordenadores del aula</h2>
<p>Para crear un chat con otros ordenadores –en este caso no serán del aula, sino con una máquina virtual, pero los conceptos vienen a ser los mismos–, hay que ponerse a escu­char en un puerto con uno de los ordenadores y, con el otro, conectarte a él.</p>
<p>Para comprobar la información sobre los puertos, emplearemos el comando <span class="codigo">ss</span> en vez del que se pide, <span class="codigo">netstat</span>, ya que al menos en OpenSuse Tumbleweed 15.0, dicho comando está obsoleto, tal y como se indica en el <a href="https://linux.die.net/man/8/netstat">manual</a>:</p>
<div class="comando comando-linux"><pre><code>This program is obsolete. Replacement for <b>netstat</b> is <b>ss</b>. Replacement for <b>netstat -r</b> is <b>ip route</b>. Replacement for <b>netstat -i</b> is <b>ip -s link</b>. Replacement for <b>netstat -g</b> is <b>ip maddr</b>.</code></pre></div>
<p>Por esta razón, emplearemos el comando <span class="codigo">ss</span>, con las mismas opciones que con <span class="codigo">netstat</span>, o séase, <span class="codigo">-antp</span>, ya que son las mismas, según lo especifica su <a href="http://man7.org/linux/man-pages/man8/ss.8.html">manual</a>:</p>
<div class="comando comando-linux"><pre><code>       -a, --all
              Display both listening and non-listening (for TCP this means
              established connections) sockets.
       -n, --numeric
              Do not try to resolve service names.
       -p, --processes
              Show process using socket.
       -t, --tcp
              Display TCP sockets.</code></pre></div>
<p>Para la realización de este apartado, escucharemos en un puerto en el ordenador <span class="codigo">elena</span> –por lo tanto, será el servidor– y comprobaremos los puertos en los que esta­mos escuchando con el comando <span class="codigo">ss</span>, aunque antes de todo comprobaremos qué IP tene­mos:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: wlp2s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether a0:c5:89:e1:4f:1f brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.134/24 brd 192.168.1.255 scope global dynamic noprefixroute wlp2s0
       valid_lft 258540sec preferred_lft 258540sec
    inet6 fe80::dadb:5854:83dd:2a7e/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                                                            
LISTEN 0     1                    0.0.0.0:60093                0.0.0.0:*     users:(("nc",pid=9363,fd=3))                                                                                         
[0] 0:bash*                                          "elena" 16:09 09-mar-19</code></pre></div>
<p>Ahora, nos conectaremos desde <span class="codigo">alumno</span> –que será el cliente– a <span class="codigo">elena</span>, mediante el puerto <span class="codigo">60093</span>. También, comprobaremos las conexiones establecidas en dicho puerto:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc 192.168.1.134 60093
alumno:/home/alumno # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                 
ESTAB 0     0              192.168.1.136:50584          192.168.1.134:60093 users:(("nc",pid=3243,fd=3))                                                                                                                         
[0] 0:bash*                                              "alumno" 16:11 09-mar-19</code></pre></div>
<p>Procedemos a hacerlo al revés, siendo <span class="codigo">alumno</span> el cliente y <span class="codigo">elena</span> el servidor.</p>
<p>Comprobamos qué IP tenemos con <span class="codigo">alumno</span>, escuchamos en un puerto y comproba­mos los puertos en los que estamos escuchando:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:75:00:ff brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.136/24 brd 192.168.1.255 scope global dynamic noprefixroute enp0s3
       valid_lft 258999sec preferred_lft 258999sec
    inet6 fe80::f3f6:6025:c3e7:4ae8/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
alumno:/home/alumno # nc -l 60093
alumno:/home/alumno # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                                                            
LISTEN 0     1                    0.0.0.0:60093                0.0.0.0:*     users:(("nc",pid=3898,fd=3))                                                                                                                                          
[0] 0:bash*                                              "alumno" 16:12 09-mar-19</code></pre></div>
<p>Nos conectamos desde <span class="codigo">elena</span> a <span class="codigo">alumno</span> mediante el puerto <span class="codigo">60093</span> y compro­bamos las conexiones establecidas en dicho puerto:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc 192.168.1.136 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                 
ESTAB    0     0                192.168.1.134:60032           192.168.1.136:60093                  users:(("nc",pid=9623,fd=3))                                                                                                                                                    
[0] 0:bash*                                          "elena" 16:13 09-mar-19</code></pre></div>
<p>Finalmente, nos conectaremos con dos compañeros de clase, por lo que escuchare­mos en puertos diferentes, para evitar el conflicto producido al escuchar en la misma IP y en el mismo puerto simultáneamente.</p>
<p>Escuchamos con <span class="codigo">elena</span> en dos puertos distintos:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60094</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093
[0] 0:bash*                                          "elena" 16:28 09-mar-19</code></pre></div>
<p>Nos conectamos desde <span class="codigo">alumno</span> a <span class="codigo">elena</span> por el puerto <span class="codigo">60094</span>:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc 192.168.1.134 60094
alumno:/home/alumno # ss -antp | grep State &amp;&amp; ss -antp | grep 60094
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                 
ESTAB       0       0         192.168.1.136:57970     192.168.1.134:60094   users:(("nc",pid=5873,fd=3))                                                                                                                                                                                                      
[0] 0:bash*                                              "alumno" 16:29 09-mar-19</code></pre></div>
<p>Y también nos conectamos desde <span class="codigo">otro</span> a <span class="codigo">elena</span> por el puerto <span class="codigo">60093</span>:</p>
<div class="comando comando-linux"><pre><code>otro:/home/otro # nc 192.168.1.134 60093
otro:/home/otro # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                 
ESTAB       0       0         192.168.1.137:47062     192.168.1.134:60093   users:(("nc",pid=2974,fd=3))                                                                                                                                                                                                      
[0] 0:bash*                                                "otro" 16:30 09-mar-19</code></pre></div>
<p>Por último, comprobamos las conexiones de <span class="codigo">elena</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60094</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ss -antp | grep State &amp;&amp; ss -antp | grep 6009
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port                                                                                                                            
LISTEN    1     1                     0.0.0.0:60093                 0.0.0.0:*                      users:(("nc",pid=9929,fd=3))                           
LISTEN    0     1                     0.0.0.0:60094                 0.0.0.0:*                      users:(("nc",pid=10040,fd=3))                          
ESTAB     0     0               192.168.1.134:60093           192.168.1.137:47062                  users:(("nc",pid=9929,fd=4))                           
ESTAB     0     0               192.168.1.134:60094           192.168.1.136:57970                  users:(("nc",pid=10040,fd=4))                                                                                                                                      
[0] 0:bash*                                          "elena" 16:30 09-mar-19</code></pre></div>
<h2>Proteger a un servidor de chat</h2>
<p>Crearemos un servidor en <span class="codigo">elena</span> que escuche en la dirección IP de nuestro ordenador y otro en la dirección <span class="codigo">127.0.0.1</span>, ambos en el puerto <span class="codigo">60093</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 192.168.1.134 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 127.0.0.1 60093                                                                                        
[0] 0:bash*                                          "elena" 18:12 14-mar-19</code></pre></div>
<p>Estos pueden funcionar simultáneamente en el mismo puerto debido a que la clave pri­maria de escucha en un puerto es la dirección IP más el puerto, a la vez, por lo que el identifi-cador no es el mismo, ya que sus direcciones IP son distintas.</p>
<p>El usuario <span class="codigo">alumno</span> intentará conectarse por ambas direcciones IP y puertos:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc 192.168.1.134 60093
alumno:/home/alumno # nc 127.0.0.1 60093
alumno:/home/alumno #                                                                                                                         
[0] 0:bash*                                              "alumno" 18:10 14-mar-19</code></pre></div>
<p>Con la primera dirección, la <span class="codigo">192.168.1.134</span> sí logra conectarse, pero al intentarlo por la <span class="codigo">127.0.0.1</span> no puede debido a que dicha dirección hace referencia a uno mismo y este se cree que es él, y ese puerto no lo hemos abierto nosotros manualmente.</p>
<p>Por el contrario, <span class="codigo">elena</span> sí se puede conectar a dicha IP por ese puerto:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 192.168.1.134 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 127.0.0.1 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc 127.0.0.1 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ss -antp | grep State &amp;&amp; ss -antp | grep 60093
State Recv-Q Send-Q         Local Address:Port            Peer Address:Port    
LISTEN 0     1                  127.0.0.1:60093                0.0.0.0:*     users:(("nc",pid=11120,fd=3))                                                 
LISTEN 0     1              192.168.1.134:60093                0.0.0.0:*     users:(("nc",pid=11118,fd=3))                                                 
ESTAB 0     0                  127.0.0.1:60093              127.0.0.1:54948 users:(("nc",pid=11120,fd=4))                                                 
ESTAB 0     0                  127.0.0.1:54948              127.0.0.1:60093 users:(("nc",pid=11295,fd=3))                                                 
ESTAB 0     0              192.168.1.134:60093          192.168.1.136:45482 users:(("nc",pid=11118,fd=4))                                                                                                                               
[0] 0:bash*                                          "elena" 18:12 14-mar-19</code></pre></div>
<h2>Enviar información de ficheros</h2>
<p>Vamos a enviar información de los directorios de <span class="codigo">$HOME</span> por medio de tuberías.</p>
<p>Primero, nos ponemos a escuchar en <span class="codigo">alumno</span> en el puerto <span class="codigo">60093</span>:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093</code></pre></div>
<p>Después, enviamos la información los directorios de nuestra <span class="codigo">$HOME</span> de <span class="codigo">elena</span> a <span class="codigo">alumno</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ls -la $HOME | nc 192.168.1.136 60093</code></pre></div>
<p>Y vemos la información que ha recibido <span class="codigo">alumno</span> de <span class="codigo">elena</span>:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093
total 72
drwx------ 1 root root  322 mar 9 16:38 .
drwxr-xr-x 1 root root  172 feb 23 11:54 ..
-rw------- 1 root root 13492 mar 9 16:38 .bash_history
-rw-r--r-- 1 root root  156 ene 23 12:35 .bashrc
drwxr-xr-x 1 root root    0 ene 30 00:30 bin
drwx------ 1 root root  194 feb 21 23:43 .cache
drwxr-xr-x 1 root root   22 feb 1 15:53 .config
drwx------ 1 root root   22 ene 23 22:20 .dbus
drwx------ 1 root root   22 ene 30 00:30 .gnupg
drwxr-xr-x 1 root root   36 ene 23 11:59 inst-sys
-rw------- 1 root root  138 mar 4 06:21 .lesshst
-rw------- 1 root root   39 feb 13 12:46 .node_repl_history
drwxr-xr-x 1 root root    8 ene 23 13:02 oradiag_root
-rw------- 1 root root 14262 mar 8 09:36 .sqlplus_history
drwx------ 1 root root   22 ene 26 20:16 .ssh
-rw------- 1 root root 13906 mar 6 10:02 .viminfo
drwx------ 1 root root    0 feb 24 15:19 .w3m
-rw------- 1 root root   55 mar 9 16:02 .xauthkaSgpS
-rw------- 1 root root   55 mar 9 16:35 .xauthU38B1X
-rw------- 1 root root   55 mar 9 15:58 .xauthu6eBiH</code></pre></div>
<p>Invertimos el papel de cliente y servidor para enviar la ayuda del comando <span class="codigo">nc</span>.</p>
<p>Nos ponemos en modo de escucha en <span class="codigo">elena</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093</code></pre></div>
<p>Enviamos la información del comando <span class="codigo">nc</span> de <span class="codigo">alumno</span> a <span class="codigo">elena</span>:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # man nc | nc 192.168.1.134 60093</code></pre></div>
<p>En <span class="codigo">elena</span> vemos cómo hemos recibido el manual del comando <span class="codigo">nc</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093
           $ nc -x10.2.3.4:8080 -Xconnect host.example.com 42
     The same example again, this time enabling proxy authentication with username "ruser" if the proxy requires
     it:
           $ nc -x10.2.3.4:8080 -Xconnect -Pruser host.example.com 42
SEE ALSO
     cat(1), ssh(1)
AUTHORS
     Original implementation by *Hobbit* &lt;hobbit@avian.org&gt;.
     Rewritten with IPv6 support by
     Eric Jackson &lt;ericj@monkey.org&gt;.
     Modified for Debian port by Aron Xu ⟨aron@debian.org⟩.
CAVEATS
     UDP port scans using the -uz combination of flags will always report success irrespective of the target ma-
     chine's state. However, in conjunction with a traffic sniffer either on the target machine or an intermedi-
     ary device, the -uz combination could be useful for communications diagnostics. Note that the amount of UDP
     traffic generated may be limited either due to hardware resources and/or configuration settings.
BSD                                            September 25, 2018                                           BSD</code></pre></div>
<p>De la misma manera, solo que grabando la información recibida a un archivo, transferi­remos una imagen al otro y viceversa:</p>
<p>Nos ponemos en modo de escucha en <span class="codigo">alumno</span> en el puerto <span class="codigo">60093</span> y nos preparamos para grabar la información que llegue a un archivo de imagen:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093 &gt; imagen.jpg</code></pre></div>
<p>Enviamos la foto de <span class="codigo">elena</span> a <span class="codigo">alumno</span> y comprobamos cuánto ocupa esta:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # cat opensuse-1551910063720-5495.jpg | nc 192.168.1.136 60093</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ls -l opensuse-1551910063720-5495.jpg
-rw-r--r-- 1 root root 135470 mar 9 16:40 opensuse-1551910063720-5495.jpg                                                                                                                                                   
[0] 0:bash*                                          "elena" 16:49 09-mar-19</code></pre></div>
<p>Recibimos la imagen en <span class="codigo">alumno</span> y comprobamos su peso para verificar que se ha transmitido todo el contenido. Ejecutamos el comando de visualización de la misma:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093 &gt; imagen.jpg
alumno:/home/alumno #
alumno:/home/alumno # ls -l imagen.jpg
-rw-r--r-- 1 root root 135470 mar 9 16:47 imagen.jpg
alumno:/home/alumno # display imagen.jpg                                                                                                                        
[0] 0:bash*                                              "alumno" 16:48 09-mar-19</code></pre></div>
<figure>
    <img src="01.png" class="img_grande" />
    <figcaption><b>Figura 1</b>: Visualización de la imagen recibida por <span class="codigo">alumno</span></figcaption>
</figure>
<p>Cambiamos los papeles de servidor y cliente.</p>
<p>Entramos en modo de escucha con <span class="codigo">elena</span> en el puerto <span class="codigo">60093</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093 &gt; imagen.jpg</code></pre></div>
<p>Enviamos la foto de <span class="codigo">alumno</span> a <span class="codigo">elena</span> y comprobamos su peso</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # cat imagen.jpg | nc 192.168.1.134 60093
alumno:/home/alumno # ls -l imagen.jpg
-rw-r--r-- 1 root root 135470 mar 9 16:47 imagen.jpg                                                                                                             
[0] 0:bash*                                              "alumno" 16:51 09-mar-19</code></pre></div>
<p>Recibimos la imagen en <span class="codigo">elena</span> –hay veces hay que cortar manualmente la transferencia de un archivo, antes revisamos que tengan el mismo tamaño– y comproba­mos cuánto pesa para verificar que se ha transmitido todo el contenido. Ejecutamos el co­mando de visualización de la misma:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093 &gt; imagen.jpg
^C</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram #/</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # ls -l imagen.jpg
-rw-r--r-- 1 root root 135470 mar 9 16:52 imagen.jpg/</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # display imagen.jpg                                                                                                                                             
[0] 0:bash*                                          "elena" 16:53 09-mar-19</code></pre></div>
<figure>
    <img src="02.png" class="img_grande" />
    <figcaption><b>Figura 2</b>: Visualización de la imagen recibida por <span class="codigo">elena</span></figcaption>
</figure>
<h2>Enviar una máquina virtual a un compañero</h2>
<p>Con una máquina virtual en un fichero <span class="codigo">.iso</span>, <span class="codigo">.ova</span>, etc., vamos a transferir una a algún compañero –o máquina virtual–, midiendo el tiempo de transmisión con el comando <span class="codigo">time</span> y, en el receptor, monitorizando el progreso del directorio de destino con <span class="codigo">watch</span>.</p>
<p>Entramos al modo de escucha desde <span class="codigo">alumno</span> en el puerto <span class="codigo">60093</span> y nos preparamos para grabar la información que llegue a un archivo <span class="codigo">.ova</span>:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093 &gt; maquina.ova</code></pre></div>
<p>Enviamos la máquina virtual de <span class="codigo">elena</span> a <span class="codigo">alumno</span> con la opción de medir el tiempo para el siguiente comando que sea ejecutado:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # time cat OpenSolaris2009.ova | nc 192.168.1.136 60093</code></pre></div>
<p>En <span class="codigo">alumno</span> vemos cómo va aumentando el tamaño de nuestro archivo:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093 &gt; maquina.ova
alumno:/home/alumno # watch -d ls -l                                                                                                                        
Every 2,0s: ls -l                         192.168.1.136: Sat Mar 9 17:03:26 2019
total 693880
drwxr-xr-x 2 alumno users      4096 mar 4 13:48 bin
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Descargas
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Documentos
drwxr-xr-x 2 alumno users      4096 mar 4 13:51 Escritorio
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Imágenes
-rw-r--r-- 1 root  root     135470 mar 9 16:47 imagen.jpg
-rw-r--r-- 1 root  root  710335712 mar 9 17:03 maquina.ova
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Música
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Plantillas
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Público
-rw-r--r-- 1 root  root          0 mar 9 16:06 redes
-rw-r--r-- 1 root  root       1288 mar 9 16:04 redes1-2.txt
-rw-r--r-- 1 root  root       1288 mar 9 16:10 redes2-2.txt
-rw-r--r-- 1 root  root       1288 mar 9 16:27 redes3-2.txt
-rw-r--r-- 1 root  root       1127 mar 9 16:35 redes4-2.txt
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Vídeos
[0] 0:watch*                                             "alumno" 17:03 09-mar-19</code></pre></div>
<p>El archivo ya ha sido transferido a <span class="codigo">alumno</span>, por eso el comando <span class="codigo">watch</span> ya no cambia:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # nc -l 60093 &gt; maquina.ova
alumno:/home/alumno # watch -d ls -l                                                                                                                        
Every 2,0s: ls -l                                alumno: Sat Mar 9 17:04:03 2019
total 1407540
drwxr-xr-x 2 alumno users      4096 mar 4 13:48 bin
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Descargas
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Documentos
drwxr-xr-x 2 alumno users      4096 mar 4 13:51 Escritorio
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Imágenes
-rw-r--r-- 1 root  root     135470 mar 9 16:47 imagen.jpg
-rw-r--r-- 1 root  root 1441121280 mar 9 17:03 maquina.ova
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Música
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Plantillas
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Público
-rw-r--r-- 1 root  root          0 mar 9 16:06 redes
-rw-r--r-- 1 root  root       1288 mar 9 16:04 redes1-2.txt
-rw-r--r-- 1 root  root       1288 mar 9 16:10 redes2-2.txt
-rw-r--r-- 1 root  root       1288 mar 9 16:27 redes3-2.txt
-rw-r--r-- 1 root  root       1127 mar 9 16:35 redes4-2.txt
drwxr-xr-x 2 alumno users      4096 mar 4 13:50 Vídeos
[0] 0:watch*                                             "alumno" 17:04 09-mar-19</code></pre></div>
<p>Volvemos a <span class="codigo">elena</span> para revisar cuánto tiempo ha tardado en total la transferencia, el cual es mayor al tiempo que ha durado realmente, ya que lo hemos tenido que cortar manualmente:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # time cat OpenSolaris2009.ova | nc 192.168.1.136 60093
^C
real   0m41,406s
user   0m0,446s
sys    0m5,072s</code></pre></div>
<p>Volvemos a hacer la misma serie de operaciones, de manera inversa:</p>
<p>Entramos al modo de escucha desde <span class="codigo">elena</span> en el puerto <span class="codigo">60093</span> y nos prepara­mos para grabar la información que llegue a un archivo <span class="codigo">.ova</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093 &gt; 0maquina.ova</code></pre></div>
<p>Enviamos la máquina virtual de <span class="codigo">alumno</span> a <span class="codigo">elena</span> con la opción de medir el tiempo para el siguiente comando que sea ejecutado:</p>
<div class="comando comando-linux"><pre><code>alumno:/home/alumno # time cat maquina.ova | nc 192.168.1.134 60093</code></pre></div>
<p>En <span class="codigo">elena</span> vemos cómo va aumentando el tamaño de nuestro archivo:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093 &gt; 0maquina.ova</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # watch -d ls -l                                                                                                                        
Every 2,0s: ls -l                            elena: Sat Mar 9 17:13:08 2019
total 1932812
-rw-r--r-- 1 root   root  532905984 mar 9 17:13 0maquina.ova
-rw-r--r-- 1 lg-gram users    408193 mar 9 16:11 1.png
-rw-r--r-- 1 lg-gram users    412856 mar 9 16:13 2.png
-rwxr-xr-x 1 lg-gram users        68 feb 6 23:13 academia.sql
drwxr-xr-x 1 lg-gram users         0 ene 23 12:18 bin
-rwxr-xr-x 1 lg-gram users      2159 feb 9 23:41 Ciudades_España.txt
-rwxr-xr-x 1 lg-gram users     88192 ene 30 13:46 datamodeler.log
drwxr-xr-x 1 lg-gram users       226 mar 9 14:42 Descargas
drwxr-xr-x 1 lg-gram users      2024 mar 6 23:30 Documentos
drwxr-xr-x 1 lg-gram users      1314 mar 4 11:49 Escritorio
drwxr-xr-x 1 lg-gram users        82 mar 8 15:43 Imágenes
[0] 0:watch*                                         "elena" 17:13 09-mar-19</code></pre></div>
<p>El archivo ya ha sido transferido a <span class="codigo">elena</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093 &gt; 0maquina.ova</code></pre></div>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # watch -d ls -l                                                                                                                        
Every 2,0s: ls -l                            elena: Sat Mar 9 17:13:08 2019
total 2820264
-rw-r--r-- 1 root   root 1441121280 mar 9 17:13 0maquina.ova
-rw-r--r-- 1 lg-gram users    408193 mar 9 16:11 1.png
-rw-r--r-- 1 lg-gram users    412856 mar 9 16:13 2.png
-rwxr-xr-x 1 lg-gram users        68 feb 6 23:13 academia.sql
drwxr-xr-x 1 lg-gram users         0 ene 23 12:18 bin
-rwxr-xr-x 1 lg-gram users      2159 feb 9 23:41 Ciudades_España.txt
-rwxr-xr-x 1 lg-gram users     88192 ene 30 13:46 datamodeler.log
drwxr-xr-x 1 lg-gram users       226 mar 9 14:42 Descargas
drwxr-xr-x 1 lg-gram users      2024 mar 6 23:30 Documentos
drwxr-xr-x 1 lg-gram users      1314 mar 4 11:49 Escritorio
drwxr-xr-x 1 lg-gram users        82 mar 8 15:43 Imágenes
[0] 0:watch*                                         "elena" 17:13 09-mar-19</code></pre></div>
<p>Volvemos a <span class="codigo">alumno</span> para revisar cuánto tiempo ha tardado en total la transferencia y, como antes, hemos tenido que finalizar la conexión manualmente:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # time cat maquina.ova | nc 192.168.1.134 60093
^C
real   0m27,647s
user   0m0,078s
sys    0m16,201s</code></pre></div>
<h2>Simulación de un servidor web</h2>
<p>Crearemos un servidor en el puerto <span class="codigo">60093</span> y, utilizando un navegador web, visitaremos el servidor en la URL <a href="http://localhost:60093/">http://localhost:60093</a>. Hay que conseguir que en este se vea represen­tado, mediante un archivo HTML o introducido a mano el código, un título de nivel 1 (<span class="codigo">&lt;h1&gt;</span>), letra negrita (<span class="codigo">&lt;b&gt;</span>) y cursiva (<span class="codigo">&lt;i&gt;</span>). Tiene que funcionar tanto en Mozilla Firefox como en un navegador de la rama de Google Chrome, es decir, <a href="https://en.wikipedia.org/wiki/List_of_web_browsers#Blink-based"><i>blink-based</i></a>.</p>
<p>Para esto, hay que emplear un lenguaje que los navegadores entiendan. Después de ponernos a escuchar en el puerto <span class="codigo">60093</span>, una vez el navegador haya introducido la anterior URL, automáticamente en el lado del servidor aparecerán las siguientes líneas, en azul:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093
GET / HTTP/1.1
Host: localhost:60093
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:64.0) Gecko/20100101 Firefox/64.0                                 
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8                                          
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Upgrade-Insecure-Requests: 1</code></pre></div>
<p>El lenguaje que entienden se encabeza por las siguientes tres primeras líneas, pudiendo la codificación (<span class="codigo">charset</span>) incrustarse directamente en el HTML. Obligatoriamente han de realizarse dos saltos de línea entre <span class="codigo">content</span> y el principio del lenguaje HTML:</p>
<div class="comando comando-linux"><pre><code>HTTP/1.1
Server:Hola
Content-Type:text/html;charset=UTF-8
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;
Servidor web
&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;
Un título de nivel 1
&lt;/h1&gt;
&lt;p&gt;
Un ejemplo de página que tiene
&lt;b&gt;
negrita
&lt;/b&gt;
 y
&lt;i&gt;
cursiva.
&lt;/i&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>
<p>Y se vería representado en nuestro navegador de la siguiente manera:</p>
<figure>
    <img src="03.png" class="img_grande" />
    <figcaption><b>Figura 3</b>: Vista de nuestra página web creada en el navegador Mozilla Firefox</figcaption>
</figure>
<p>Si repetimos los pases anteriores pero ahora con un navegador que derive de Chro­mium, como Google Chrome o Vivaldi en este caso, las etiquetas que hemos puesto se ve­rán únicamente como código:</p>
<figure>
    <img src="04.png" class="img_grande" />
    <figcaption><b>Figura 4</b>: Código anterior ahora en Vivaldi. Solo se ven las etiquetas no se ven, estas no adquieren una forma</figcaption>
</figure>
<p>Esto es debido a que este tipo de navegadores requieren de algo más para que funcio­nen, concretamente de una pequeña confirmación por parte del servidor en el encabeza­miento, por lo que simplemente añadiremos <span class="codigo">200 OK</span> después de <span class="codigo">HTTP/1.1</span>:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc -l 60093
GET / HTTP/1.1
Host: localhost:60093
Connection: keep-alive
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.113 Safari/537.36 Vivaldi/2.1.1337.51
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: es-ES,es;q=0.9
HTTP/1.1 200 OK
Server:Hola
Content-Type:text/html;charset=UTF-8
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;
Servidor web
&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;
Un título de nivel 1
&lt;/h1&gt;
&lt;p&gt;
Un ejemplo de página que tiene
&lt;b&gt;
negrita
&lt;/b&gt;
 y
&lt;i&gt;
cursiva.
&lt;/i&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>
<figure>
    <img src="05.png" class="img_grande" />
    <figcaption><b>Figura 5</b>: En Vivaldi se requiere de la confirmación <span class="codigo">200 OK</span> por parte del servidor para que funcione correc­tamente</figcaption>
</figure>
<h2>Simulación de un cliente web</h2>
<p>Ya para acabar, utilizaremos directamente el protocolo HTTP para pedir una página a un servidor, el de la DGT, para ver si hay atasco o no de camino a casa. El puerto del proto­colo HTTP es el <span class="codigo">80</span>, y la dirección web de la DGT es <a href="http://www.dgt.es/">www.dgt.es</a>. Con las dos primeras líneas y después los dos saltos de línea, solicitaremos el archivo deseado:</p>
<div class="comando comando-linux"><pre><code>elena:/home/lg-gram # nc www.dgt.es 80
GET /gsm.txt HTTP/1.1
Host:www.dgt.es
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: max-age=120
Content-Type: text/plain; charset=UTF-8
Date: Sat, 09 Mar 2019 16:41:42 GMT
Etag: "6e7fa-693-583abfdcb7877"
Expires: Sat, 09 Mar 2019 16:43:42 GMT
Last-Modified: Sat, 09 Mar 2019 16:40:04 GMT
Server: ECAcc (toj/8918)
X-Cache: HIT
X-UA-Compatible: IE=edge
Content-Length: 1683
CLUMONDO�EDO                              VVA-8       536 552*                                      
CNAIRATI                                  NNNA-2012     8  8*                                      
CNAPIKATUA                                NNNA-2011     7 11*                                      
RGRSIERRA NEVADA                          1NA-4025      0  8*                                      
RSACANDELARIO                             1NDSA-191     8 11*                                      
RTFBUENAVISTA DEL NORTE                   1NTF-445      3  9*                                      
OBISANTURTZI                               NN-644     130 130*SANTURTZI                             
OGICABANELLES                              NN-260      53 57*DESVIAMENT PER N-260A                 
OMASIERRA DE YEGUAS                        NA-7279      0 15*                                      
OMAVI�UELA                                 NA-7205     11 11*                                      
ONATUDELA                                  NN-121C      2  2*                                      
RB BARCELONA                              2AB-20        6  9SNUS LLOBREGAT-UN CARRIL TALLAT        
RB BARCELONA                              1AB-20        6  5NNUS TRINITAT                          
RB CASTELLBELL I EL VILAR                 1NC-1411A    12 13*DE 15:30 A 18 HORES                   
RB MOI�                                   5NC-59       38 39*RUA DE CARNESTOLTES DE MOI�           
RCASAN FERNANDO                           3ACA-33      13 13-C�DIZ                                 
$$</code></pre></div>
<p>Pues parece que por Alcalá de Henares no hay atasco hoy, ¡así que llegaremos a nues­tra hora a casa!</p>
<footer>
	<span class="last-modified"><span id="modify"></span></span>
    <span class="author">Elena de Diego</span>
</footer>
</div>
</div>
<script src="../functions.js"></script>
</body>
</html>
